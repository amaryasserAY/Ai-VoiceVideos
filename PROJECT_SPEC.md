## وثيقة توصيف مشروع: المونتير الذكي (AI Voice Video Editor)

### عنوان المشروع

تطبيق مونتاج فيديو ذكي يعتمد على الأوامر الصوتية والوسائط المتعددة (Multimodal AI).

### 1) الفكرة العامة (The Concept)

بناء أداة برمجية تعمل كمساعد مونتاج شخصي، بهدف كسر حاجز التعامل مع برامج المونتاج المعقدة. بدلاً من استخدام الفأرة وقص الـ Timeline يدوياً، يقوم المستخدم بالتحدث مع التطبيق (مثلاً: “قص الدقيقة الأولى وشيل الصوت”). يقوم التطبيق بفهم هذه الأوامر (سواء كانت نصية أو صوتية) وتحويلها إلى عمليات معالجة فيديو فعلية وتنفيذها في ثوانٍ.

### 2) الهيكلية التقنية (Technical Architecture)

تم بناء المشروع باستخدام Python كعمود فقري، مع دمج المكونات التالية:

- **الواجهة (Frontend)**: Streamlit لبناء واجهة تفاعلية تعمل على المتصفح.
- **محرك المعالجة (Backend Engine)**: MoviePy + FFmpeg لمعالجة الفيديو (قص، كتم صوت، تغيير سرعة، فلاتر…).
- **العقل المدبر (AI Brain)**: Google Gemini 2.5 Flash عبر API.
  - تم اختياره لسرعته ودعمه للوسائط المتعددة (Multimodal) بحيث يمكنه تحليل ملف صوت مباشرة.
- **معالجة الصوت (Audio)**:
  - تسجيل الصوت من المتصفح عبر `audiorecorder`.
  - دعم توافق Python 3.13 لمكتبة `audioop` عبر fallback إلى `audioop_lts`.
- **التصميم (UI Styling)**: فصل CSS في `style.css` لبناء واجهة عصرية و Timeline متجاوب.

### 3) سيناريو العمل (Workflow Logic)

الخوارزمية التشغيلية من 5 مراحل:

#### 3.1 الإدخال (Input)

- رفع ملف فيديو (MP4/MOV).
- تحليل الفيديو واستخراج “شريط زمني مرئي” (Visual Timeline) يعرض صوراً مصغرة (Thumbnails) موزعة زمنياً لمساعدة المستخدم على اتخاذ القرار.

#### 3.2 التوجيه (Commanding)

- إدخال الأمر إما:
  - **أمر صوتي** (تسجيل من المتصفح).
  - **أمر نصي** (كتابة مباشرة).
- مثال: “شيل اول 5 ثواني، وسرع الفيديو، واقلبه ابيض واسود”.

#### 3.3 التحليل الذكي (AI Analysis)

- إرسال ملف الصوت (أو النص) إلى Gemini API.
- تم تصميم الـ prompt بحيث يعيد النموذج **مخرجات حصرية بصيغة JSON Array** تحتوي على قائمة مهام تحرير.

مثال:

```json
[
  { "action": "trim", "start": 0, "end": 5 },
  { "action": "speed", "factor": 2.0 }
]
```

#### 3.4 التنفيذ المتسلسل (Execution Loop)

- يستقبل كود Python مصفوفة JSON.
- يدخل في حلقة تكرارية لتطبيق التعديلات واحدة تلو الأخرى على الفيديو باستخدام MoviePy.

#### 3.5 الإخراج (Output)

- تصدير الفيديو النهائي بجودة عالية (Codecs: `libx264`/`aac`).
- حفظ الفيديو في مجلد محلي منظم بالتاريخ: `My_Produced_Videos`.

### 4) المميزات الاحترافية المضافة (Key Features)

- **Multi-Step Editing**: تنفيذ سلسلة أوامر في طلب واحد عبر JSON Array.
- **Smart Caching**: استخدام `@st.cache_data(persist="disk")` لتقليل استهلاك التوكينز وتسريع الاستجابة للأوامر المكررة.
- **Custom Styling (CSS)**: فصل التصميم في `style.css` وبناء Timeline تفاعلي (تمرير أفقي، hover، شارات وقت).
- **Robustness / المتانة**:
  - حل توافق Python 3.13 للصوت عبر `audioop_lts`.
  - تضمين FFmpeg داخل المشروع وإضافة مسار المشروع إلى `PATH` لضمان عمل التطبيق على أجهزة Windows بدون تثبيتات إضافية.

### 5) الهدف النهائي (Final Goal)

تحويل النموذج الأولي (Prototype) إلى **تطبيق سطح مكتب (Desktop App)** متكامل يخدم صناع المحتوى لإنتاج الفيديوهات القصيرة (Shorts/Reels) بسرعة عالية تعتمد على الصوت فقط، مع تجربة مستخدم مبسطة وقوية.

### 6) حدود النسخة الحالية (Current Scope)

النسخة الحالية تدعم هذه الأوامر فقط (كما هو مطبق في `app.py`):

- `trim` (حقول: `start`, `end`)
- `mute`
- `speed` (حقل: `factor`)
- `black_white`

وتُعرض خطة التنفيذ للمستخدم في الواجهة بصيغة JSON قبل تطبيقها.
